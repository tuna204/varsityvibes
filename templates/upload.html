<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Varsity Vibes | Upload Design</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      min-height: 100vh;
    }
    .card {
      backdrop-filter: blur(12px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 4px 30px rgba(0,0,0,0.2);
    }
    input, button {
      outline: none;
    }
    input[type="text"], input[type="file"] {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      width: 100%;
      padding: 10px;
      border-radius: 0.5rem;
    }
    input::file-selector-button {
      background: #6d28d9;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 0.5rem;
      cursor: pointer;
    }
  </style>
</head>

<body class="text-white flex flex-col items-center py-10">

  <h1 class="text-4xl font-bold mb-8 bg-gradient-to-r from-pink-400 to-blue-400 text-transparent bg-clip-text">
    Varsity Vibes x Irys Upload Center
  </h1>

  <div class="w-full max-w-2xl card rounded-2xl p-8">
    <h2 class="text-2xl mb-4 font-semibold">Upload Jersey Design</h2>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="mb-4">
          {% for message in messages %}
            <li class="text-center bg-green-500/20 border border-green-500 py-2 px-4 rounded-xl">
              {{ message }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <form method="POST" enctype="multipart/form-data" class="space-y-4">
      <div>
        <label class="block text-sm mb-1">File:</label>
        <input type="file" name="file" required>
      </div>

      <div>
        <label class="block text-sm mb-1">Owner Address:</label>
        <input type="text" name="owner_address" placeholder="Enter your wallet address" required>
      </div>

      <div>
        <label class="block text-sm mb-1">Irys Address:</label>
        <input type="text" name="irys_address" placeholder="Enter Irys address" required>
      </div>

      <div>
        <label class="block text-sm mb-1">Access Rule:</label>
        <input type="text" name="rule" placeholder="e.g. VarsityPass holders only" required>
      </div>

      <hr class="my-6 border-gray-400/30">

      <!-- Irys → Execution Address Section -->
      <h3 class="text-lg font-semibold mb-2">Irys → Execution Address</h3>
      <div class="space-y-2">
        <input type="text" id="irys_address_input" placeholder="Enter Irys address"
               class="w-full bg-white/10 border border-gray-400 text-white px-3 py-2 rounded-lg" required>
        
        <!-- Hidden field to actually submit exec address -->
        <input type="hidden" id="exec_address_input" name="exec_address">

        <p class="text-sm text-gray-300">Exec Address: <span id="exec_address_output" class="text-pink-400">—</span></p>
        
        <button type="button" onclick="convertAddress()" 
                class="bg-gradient-to-r from-purple-500 to-pink-500 px-4 py-2 rounded-lg text-white hover:scale-105 transition">
            Convert Address
        </button>

        <button type="button"
                onclick="generateFakeIrysAddress()"
                class="bg-green-500 px-3 py-2 rounded-lg mt-2">
            Generate Irys Address
        </button>

      </div>

      <div class="flex justify-between items-center pt-4">
        <a href="{{ url_for('files') }}" 
           class="bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded-lg text-white">View Uploaded Files</a>
        <button type="submit" 
           class="bg-gradient-to-r from-purple-500 to-pink-500 px-6 py-2 rounded-lg text-white hover:scale-105 transition">
           Upload
        </button>
      </div>
    </form>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@irys/js/dist/irys.umd.min.js"></script>
<script>
function convertAddress() {
    const irysAddress = document.getElementById('irys_address_input').value.trim();
    if (!irysAddress) {
        alert('Please enter an Irys address.');
        return;
    }
    try {
        // Using the global `Irys` object from the UMD build
        const execAddress = Irys.utils.irysToExec(irysAddress);
        document.getElementById('exec_address_output').textContent = execAddress;
        document.getElementById('exec_address_input').value = execAddress;
    } catch (error) {
        console.error(error);
        alert('Invalid address format');
    }
}

// Auto-convert as user types
document.getElementById('irys_address_input').addEventListener('input', convertAddress);
</script>

  <script>
function generateFakeIrysAddress() {
    const chars = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"; // base58
    let addr = "";
    for (let i = 0; i < 48; i++) { // Irys addresses ~48 chars
        addr += chars[Math.floor(Math.random() * chars.length)];
    }
    document.getElementById("irys_address_input").value = addr;
    convertAddress();
}
</script>

</body>
</html>


